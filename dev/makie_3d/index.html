<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>3D Makie recipes · PlantGeom.jl</title><meta name="title" content="3D Makie recipes · PlantGeom.jl"/><meta property="og:title" content="3D Makie recipes · PlantGeom.jl"/><meta property="twitter:title" content="3D Makie recipes · PlantGeom.jl"/><meta name="description" content="Documentation for PlantGeom.jl."/><meta property="og:description" content="Documentation for PlantGeom.jl."/><meta property="twitter:description" content="Documentation for PlantGeom.jl."/><meta property="og:url" content="https://VEZY.github.io/PlantGeom.jl/makie_3d/"/><meta property="twitter:url" content="https://VEZY.github.io/PlantGeom.jl/makie_3d/"/><link rel="canonical" href="https://VEZY.github.io/PlantGeom.jl/makie_3d/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">PlantGeom.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Plot recipes</span><ul><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">MTG diagrams</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../plot_diagram/makie_diagram/">Makie.jl</a></li><li><a class="tocitem" href="../plot_diagram/plots_diagram/">Plots.jl</a></li></ul></li><li class="is-active"><a class="tocitem" href>3D Makie recipes</a><ul class="internal"><li><a class="tocitem" href="#Interactive-plot"><span>Interactive plot</span></a></li><li><a class="tocitem" href="#Colors"><span>Colors</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../API/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Plot recipes</a></li><li class="is-active"><a href>3D Makie recipes</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>3D Makie recipes</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/VEZY/PlantGeom.jl/blob/main/docs/src/makie_3d.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="3D-plots-(meshes)"><a class="docs-heading-anchor" href="#3D-plots-(meshes)">3D plots (meshes)</a><a id="3D-plots-(meshes)-1"></a><a class="docs-heading-anchor-permalink" href="#3D-plots-(meshes)" title="Permalink"></a></h1><p><code>PlantGeom</code> uses <a href="https://makie.juliaplots.org/stable/"><code>Makie.jl</code></a> to make 3d mesh plots. It also uses <a href="https://github.com/JuliaGeometry/MeshViz.jl">MeshViz.jl</a> that is also based on Makie.</p><p>This way the plots you make using <code>PlantGeom</code> support all the nice possibilities offered by Makie, such as making sub-plots, interactive plots...</p><h2 id="Interactive-plot"><a class="docs-heading-anchor" href="#Interactive-plot">Interactive plot</a><a id="Interactive-plot-1"></a><a class="docs-heading-anchor-permalink" href="#Interactive-plot" title="Permalink"></a></h2><p>Here comes the fun part! We can make 3D representations of the plants based on the geometry of each of its nodes.</p><p>If you read your MTG from an OPF file, the 3D geometry should already be computed, so you just have to <code>viz()</code> the MTG.</p><p>Because we&#39;re plotting the interactive plot in the webpage, we must use <code>JSServe</code> first (no need when using Julia from the REPL or VS Code):</p><pre><code class="language-julia hljs">using JSServe
Page(exportable=true, offline=true)</code></pre><p>Then we can plot our interactive 3D plant:</p><pre><code class="language-julia hljs">using PlantGeom, WGLMakie
mtg = read_opf(joinpath(dirname(dirname(pathof(PlantGeom))),&quot;test&quot;,&quot;files&quot;,&quot;simple_plant.opf&quot;))
viz(mtg)</code></pre><div>
  <div class="bonito-fragment" id="a4f1f026-ea1a-4211-bd90-9a9d92ddbae4" data-jscall-id="root">
    <div>
      <script src="../../../../.julia/packages/Bonito/mxgrs/js_dependencies/Bonito.bundled.js" type="module"></script>
      <style></style>
      <div></div>
    </div>
    <div>
      <script type="module">Bonito.lock_loading(() => Bonito.init_session('a4f1f026-ea1a-4211-bd90-9a9d92ddbae4', null, 'root'))</script>
      <span></span>
    </div>
  </div>
  <div class="bonito-fragment" id="1d2140af-f1a6-4263-807a-624f2843e5c9" data-jscall-id="subsession-application-dom">
    <div>
      <style></style>
      <div></div>
    </div>
    <div>
      <script type="module">    Bonito.lock_loading(() => {
        return Bonito.fetch_binary('bonito/bin/0f6410da60cc260caaaa667122406d1f23fb33dd-7473681895053846510.bin').then(msgs=> Bonito.init_session('1d2140af-f1a6-4263-807a-624f2843e5c9', msgs, 'sub'));
    })
</script>
      <div style="width: 100%; height: 100%" data-jscall-id="1">
        <canvas style="display: block" data-jscall-id="2" tabindex="0"></canvas>
      </div>
    </div>
  </div>
</div><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>The plot may take some time to appear on your screen.</p></div></div><p>Note that the plot is interactive. This is because we use <code>WGLMakie</code> as a plotting backend. You can also use <code>GLMakie</code> for better performance, or <code>CairoMakie</code> if you want a fast, non-interactive plot.</p><h2 id="Colors"><a class="docs-heading-anchor" href="#Colors">Colors</a><a id="Colors-1"></a><a class="docs-heading-anchor-permalink" href="#Colors" title="Permalink"></a></h2><h3 id="Note-about-the-backend"><a class="docs-heading-anchor" href="#Note-about-the-backend">Note about the backend</a><a id="Note-about-the-backend-1"></a><a class="docs-heading-anchor-permalink" href="#Note-about-the-backend" title="Permalink"></a></h3><p>In this section, we will use the coffee plant provided as an example OPF file from the package. This one is more realistic than the tiny plant shown above. But because it is bigger, we will only provide static images instead of interactive plots. If you want to plot the interactive plots, you can execute the example code from below using <code>GLMakie</code> or <code>WGLMakie</code> instead of <code>CairoMakie</code> simply by replacing:</p><pre><code class="language-julia hljs">using CairoMakie</code></pre><p>By:</p><pre><code class="language-julia hljs">using GLMakie</code></pre><h3 id="Set-up"><a class="docs-heading-anchor" href="#Set-up">Set-up</a><a id="Set-up-1"></a><a class="docs-heading-anchor-permalink" href="#Set-up" title="Permalink"></a></h3><p>The first step is to compute the node meshes using the reference meshes and the transformation matrices. This is done very easily by mapping <code>refmesh_to_mesh!</code> to each node of the MTG like so:</p><pre><code class="language-julia hljs">using MultiScaleTreeGraph
transform!(mtg, refmesh_to_mesh!)</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>This step is optional, and not needed if only few plots are performed because it is done automatically when plotting an MTG, but the results are discarded afterward to avoid too much memory usage. If you plant to make many plots, we advise to do this step to avoid to wait a long time each time.</p></div></div><h3 id="Default-colors"><a class="docs-heading-anchor" href="#Default-colors">Default colors</a><a id="Default-colors-1"></a><a class="docs-heading-anchor-permalink" href="#Default-colors" title="Permalink"></a></h3><p>The default behavior of <code>viz(mtg)</code> -without providing colors- is to use the color of each reference mesh as the color of the corresponding node mesh. In other words, a leaf in a tree will be colored with the same color as the reference mesh used to represent it. This reference mesh is available as an attribute in the root node of the MTG. We can extract those reference meshes like so:</p><pre><code class="language-julia hljs">using PlantGeom, CairoMakie
CairoMakie.activate!()

file = joinpath(dirname(dirname(pathof(PlantGeom))),&quot;test&quot;,&quot;files&quot;,&quot;coffee.opf&quot;)
mtg = read_opf(file)

ref_meshes = get_ref_meshes(mtg)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">RefMeshes(RefMesh[RefMesh{String, Meshes.SimpleMesh{3, Float64, Vector{Meshes.Point3}, Meshes.SimpleTopology{Meshes.Connectivity}}, Phong{Float64, ColorTypes.RGBA{Float64}}, Vector{Meshes.Point3}, Vector{Meshes.Point2}}(&quot;Mesh0&quot;, 50 SimpleMesh{3,Float64}, Meshes.Point3[Point(-0.0, -0.9980268, 0.062789984), Point(-0.0, -0.9822871, -0.18738201), Point(-0.0, -0.95105654, 0.30901685), Point(-0.0, -0.90482676, -0.4257799), Point(-0.0, -0.84432787, 0.5358269), Point(-0.0, -0.7705131, -0.6374241), Point(-0.0, -0.68454736, 0.72896844), Point(-0.0, -0.58778507, -0.8090171), Point(-0.0, -0.4817542, 0.87630635), Point(-0.0, -0.36812392, -0.9297768)  …  Point(-0.0, 0.3681251, -0.9297763), Point(-0.0, 0.48175377, 0.8763066), Point(-0.0, 0.58778507, -0.8090171), Point(-0.0, 0.68454695, 0.7289689), Point(-0.0, 0.7705131, -0.6374241), Point(-0.0, 0.84432787, 0.5358269), Point(-0.0, 0.9048272, -0.4257791), Point(-0.0, 0.9510565, 0.30901715), Point(-0.0, 0.9822873, -0.18738106), Point(-0.0, 0.9980268, 0.06279098)], Meshes.Point2[Point(1.0, 3.078761), Point(1.0, 3.33009), Point(1.0, 2.827433), Point(1.0, 3.581416), Point(1.0, 2.576106), Point(1.0, 3.832743), Point(1.0, 2.32478), Point(1.0, 4.084071), Point(1.0, 2.073452), Point(1.0, 4.335399)  …  Point(1.0, 5.089381), Point(1.0, 1.068141), Point(1.0, 5.340707), Point(1.0, 0.816814), Point(1.0, 5.592034), Point(1.0, 0.565487), Point(1.0, 5.843362), Point(1.0, 0.314161), Point(1.0, 6.094688), Point(1.0, 0.062827)], Phong{Float64, ColorTypes.RGBA{Float64}}(RGBA{Float64}(0.0,0.0,0.0,0.0), RGBA{Float64}(0.3,0.45,0.0,0.0), RGBA{Float64}(0.35,0.3,0.0,1.0), RGBA{Float64}(0.2,0.25,0.0,0.0), 10.0), true), RefMesh{String, Meshes.SimpleMesh{3, Float64, Vector{Meshes.Point3}, Meshes.SimpleTopology{Meshes.Connectivity}}, Phong{Float64, ColorTypes.RGBA{Float64}}, Vector{Meshes.Point3}, Nothing}(&quot;Mesh1&quot;, 12 SimpleMesh{3,Float64}, Meshes.Point3[Point(0.0, 0.0, 1.0), Point(0.0, 0.0, 1.0), Point(0.0, 0.0, 1.0), Point(0.0, 0.0, 1.0), Point(0.0, 0.0, 1.0), Point(0.0, 0.0, 1.0), Point(0.0, 0.0, 1.0), Point(0.0, 0.0, 1.0), Point(0.0, 0.0, 1.0), Point(0.0, 0.0, 1.0), Point(0.0, 0.0, 1.0)], nothing, Phong{Float64, ColorTypes.RGBA{Float64}}(RGBA{Float64}(0.0,0.0,0.0,0.0), RGBA{Float64}(0.1,0.8,0.1,0.5), RGBA{Float64}(0.1,0.7,0.1,1.0), RGBA{Float64}(0.1,0.9,0.2,0.5), 10.0), true)])</code></pre><p>Then we can plot them in sequence:</p><pre><code class="language-julia hljs">viz(ref_meshes)</code></pre><img src="17fc6b0b.png" alt="Example block output"/><p>Here we are looking at the reference meshes used to build the plant. Those meshes are then transformed by transformation matrices from each node to make the mesh of that node. So by default the color used for the nodes will be taken from these reference meshes.</p><p>If we plot the coffee plant without providing any color, we would get:</p><pre><code class="language-julia hljs">viz(mtg)</code></pre><img src="5e7b04f6.png" alt="Example block output"/><h3 id="Single-color"><a class="docs-heading-anchor" href="#Single-color">Single color</a><a id="Single-color-1"></a><a class="docs-heading-anchor-permalink" href="#Single-color" title="Permalink"></a></h3><p>Now we can change the color of all meshes by providing a single color:</p><pre><code class="language-julia hljs">viz(mtg, color = :gray87)</code></pre><img src="10959368.png" alt="Example block output"/><h3 id="Map-color-to-reference-meshes"><a class="docs-heading-anchor" href="#Map-color-to-reference-meshes">Map color to reference meshes</a><a id="Map-color-to-reference-meshes-1"></a><a class="docs-heading-anchor-permalink" href="#Map-color-to-reference-meshes" title="Permalink"></a></h3><p>We can also associate a new color to each reference mesh.</p><p>We can get the default color of each reference mesh by using:</p><pre><code class="language-julia hljs">get_ref_meshes_color(ref_meshes)</code></pre><img src='data:image/svg+xml;utf-8,<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1"
     width="50mm" height="25mm" viewBox="0 0 2 1" stroke="none"
     preserveAspectRatio="none" shape-rendering="crispEdges">
<defs>
    <pattern id="pat_3R02iN" width=".2" height=".2"
             patternUnits="userSpaceOnUse" >
        <path d="M.1,0h.1v.1h-.2v.1h.1z" fill="%23999" opacity=".5" />
    </pattern>
</defs>
<rect width="2" height="1" fill="url(%23pat_3R02iN)" />
<path d="M1,0v1h-1z" fill="%23594C00" />
<path d="M0,0h1v1h-1z" fill="%23594C00" fill-opacity="1" />
<path d="M2,0v1h-1z" fill="%231AB21A" />
<path d="M1,0h1v1h-1z" fill="%231AB21A" fill-opacity="1" />
</svg>'/><p>Now we know the first reference mesh is the cylinder (it is brown) and the second one is the leaf (it is green).</p><p>To update their colors we can simply pass the new colors as a dictionary mapping colors to reference meshes like so:</p><pre><code class="language-julia hljs">viz(mtg, color = Dict(1 =&gt; :gray87, 2 =&gt; &quot;#42A25ABD&quot;))</code></pre><img src="d4ca5083.png" alt="Example block output"/><p>If we want to update the second reference mesh only (the leaves), we would do:</p><pre><code class="language-julia hljs">viz(mtg, color = Dict(2 =&gt; &quot;#42A25ABD&quot;))</code></pre><img src="2623ea1d.png" alt="Example block output"/><h3 id="Map-color-to-attributes"><a class="docs-heading-anchor" href="#Map-color-to-attributes">Map color to attributes</a><a id="Map-color-to-attributes-1"></a><a class="docs-heading-anchor-permalink" href="#Map-color-to-attributes" title="Permalink"></a></h3><p>Maybe the most interesting coloring option is to color by attribute.</p><p>Indeed, each node in the MTG can have specific attributes, <em>e.g.</em> an area, a temperature...</p><p>You can see which attributes are available in an MTG using:</p><pre><code class="language-julia hljs">print(names(mtg))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[:geometry, :XInsertionAngle, :Variety, :XEuler, :Stifness, :ref_meshes, :Plagiotropy, :_cache_d9b4f7f3c3467a55ad26f362065777c471aee4c7, :Treatment, :Name, :FileName, :Area, :Length, :Width, :Plot, :YInsertionAngle, :StiffnessAngle, :File, :Phyllotaxy]</code></pre><p>We can see that we have an attribute called <code>:Area</code>. Let&#39;s color each organ by its area:</p><pre><code class="language-julia hljs">viz(mtg, color = :Area)</code></pre><img src="6e095ad9.png" alt="Example block output"/><p>Of course all Makie commands are available. For example we can zoom-in the plot using <code>scale!</code>, and add a colorbar:</p><pre><code class="language-julia hljs">f, ax, p = viz(mtg, color = :Area)
CairoMakie.scale!(p, 1.5, 1.5, 1.5) # we zoom-in a little bit
CairoMakie.Colorbar(f[1,2], label = &quot;Area&quot;)
f</code></pre><img src="8a1176d4.png" alt="Example block output"/><p>We can see that the colorbar is only in relative values (0-1). If you need absolute values, you can use PlantGeom&#39;s colorbar instead:</p><pre><code class="language-julia hljs">f, ax, p = viz(mtg, color = :Area)
colorbar(f[1, 2], p)
f</code></pre><img src="54498f49.png" alt="Example block output"/><h3 id="Map-color-to-vertices"><a class="docs-heading-anchor" href="#Map-color-to-vertices">Map color to vertices</a><a id="Map-color-to-vertices-1"></a><a class="docs-heading-anchor-permalink" href="#Map-color-to-vertices" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Compute the z position of each vertices in each mesh:
transform!(mtg, :geometry =&gt; (x -&gt; [i.coords[3] for i in x.mesh.vertices]) =&gt; :z, ignore_nothing = true)
viz(mtg, color = :z, showfacets = true, color_vertex = true)</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>This one is not shown because CairoMakie and WGLMakie are not compatible with coloring each vertices differently. But you can still see the results on your computer using GLMakie.</p></div></div><h3 id="Map-time-step-to-color"><a class="docs-heading-anchor" href="#Map-time-step-to-color">Map time step to color</a><a id="Map-time-step-to-color-1"></a><a class="docs-heading-anchor-permalink" href="#Map-time-step-to-color" title="Permalink"></a></h3><p>The MTG attributes can have several values, for example a value for each time step of a simulation. For example, let&#39;s make a dummy variable with 12 time-steps, each value being the area time the time step:</p><pre><code class="language-julia hljs">transform!(mtg, :Area =&gt; (x -&gt; [x*i for i in 1:12]) =&gt; :dummy_var, ignore_nothing = true)</code></pre><p>Now we can plot the plant with the color of each organ being the value of the dummy variable at time step 1 using the <code>index</code> keyword argument:</p><pre><code class="language-julia hljs">f, ax, p = viz(mtg, color = :dummy_var, index = 1)
colorbar(f[1, 2], p)
f</code></pre><img src="17915890.png" alt="Example block output"/><p>We can even make a video out of it:</p><pre><code class="language-julia hljs">f, ax, p = viz(mtg, color = :dummy_var, index = 1)
colorbar(f[1, 2], p)

record(f, &quot;coffee_steps.mp4&quot;, 1:12, framerate=2) do timestep
    p.index[] = timestep
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;coffee_steps.mp4&quot;</code></pre><p><video src="../coffee_steps.mp4" controls="true" title><a href="../coffee_steps.mp4"></a></video></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../plot_diagram/plots_diagram/">« Plots.jl</a><a class="docs-footer-nextpage" href="../API/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Thursday 23 May 2024 16:39">Thursday 23 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
